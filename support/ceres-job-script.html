<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Ceres Job Script Generator | SCINet | USDA Scientific Computing Initiative</title>



<meta name="description" content="Ceres Job Script Generator">




<link rel="shortcut icon"type="image/ico"
  href="/assets/img/site/favicons/favicon.ico">



<link rel="icon"type="image/png"
  href="/assets/img/site/favicons/favicon.png">



<link rel="icon"type="image/png"
  sizes="192x192"
  href="/assets/img/site/favicons/favicon-192.png">



<link rel="icon"type="image/png"
  sizes="32x32"
  href="/assets/img/site/favicons/favicon-32x32.png">



<link rel="icon"type="image/png"
  sizes="16x16"
  href="/assets/img/site/favicons/favicon-16x16.png">



<link rel="manifest"
  href="/assets/img/site/favicons/site.webmanifest">



<link rel="mask-icon"
  href="/assets/img/site/favicons/safari-pinned-tab.svg">



<link rel="apple-touch-icon"
  sizes="180x180"
  href="/assets/img/site/favicons/apple-touch-icon.png">



<meta name="msapplication-TileColor" content="#2b5797">



<meta name="msapplication-config" content="/assets/img/site/favicons/browserconfig.xml">



<meta name="theme-color" content="#ffffff">




  



<link rel="stylesheet"
  href="/assets/css/style.css"
  media="screen">

  
  


<!-- Digital Analytics Program roll-up, see https://analytics.usa.gov for data -->
<script id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=USDA&subagency=ARS"></script>


  
  <script>0</script>
</head>

<body class="site-90%">

  <a class="usa-skipnav" href="#main-content">Skip to main content</a>

  


  <section class="usa-banner" aria-label="Official government website">
  <div class="usa-accordion">
    <header class="usa-banner__header">
      <div class="usa-banner__inner">
        <div class="grid-col-auto">
          <img class="usa-banner__header-flag" src="/assets/uswds/img/us_flag_small.png" alt="U.S. flag">
        </div>
        <div class="grid-col-fill tablet:grid-col-auto">
          <p class="usa-banner__header-text">An official website of the United States government</p>
          <p class="usa-banner__header-action" aria-hidden="true">Here’s how you know</p>
        </div>
        <button type="button" class="usa-accordion__button usa-banner__button"
          aria-expanded="false" aria-controls="gov-banner">
          <span class="usa-banner__button-text">Here’s how you know</span>
        </button>
      </div>
    </header>
    <div class="usa-banner__content usa-accordion__content" id="gov-banner" hidden="">
      <div class="grid-row grid-gap-lg">
        <div class="usa-banner__guidance tablet:grid-col-6">
          <img class="usa-banner__icon usa-media-block__img" src="/assets/uswds/img/icon-dot-gov.svg" role="img" alt="Dot gov">
          <div class="usa-media-block__body">
            <p>
              <strong>Official websites use .gov</strong>
              <br/>
              A <strong>.gov</strong> website belongs to an official government organization in the United States.
            </p>
          </div>
        </div>
        <div class="usa-banner__guidance tablet:grid-col-6">
          <img class="usa-banner__icon usa-media-block__img" src="/assets/uswds/img/icon-https.svg" role="img" alt="Https">
          <div class="usa-media-block__body">
            <p>
              <strong>Secure .gov websites use HTTPS</strong>
              <br/>
              A <strong>lock</strong> (
<span class="icon-lock"><svg xmlns="http://www.w3.org/2000/svg" width="52" height="64" viewBox="0 0 52 64" class="usa-banner__lock-image" role="img" aria-labelledby="banner-lock-title banner-lock-description"><title id="banner-lock-title">Lock</title><desc id="banner-lock-description">A locked padlock</desc><path fill="#000000" fill-rule="evenodd" d="M26 0c10.493 0 19 8.507 19 19v9h3a4 4 0 0 1 4 4v28a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V32a4 4 0 0 1 4-4h3v-9C7 8.507 15.507 0 26 0zm0 8c-5.979 0-10.843 4.77-10.996 10.712L15 19v9h22v-9c0-6.075-4.925-11-11-11z"/></svg></span>
) or <strong>https://</strong> means you’ve safely connected to the .gov website. Share sensitive information only on official, secure websites.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>




<div class="usa-overlay"></div>
<header class="usa-header usa-header--extended sci-heading" role="banner">

  <div class="usa-navbar">
      
<div class="usa-logo">
    
    <span class="agency-logo display-flex flex-align-center mobile-lg:margin-right-1">
        
        <a href="/">
            <img class="usa-logo-img"
                src="/assets/img/site/usda-logo-color.svg"
                alt="USDA">
        </a>
        
    </span>
    
    <a class="agency-logo-text"
        href="/"
        aria-label="SCINet Scientific Computing">
        <div class="agency-identity">
            <div class="agency-name usa-logo__text">SCINet Scientific Computing</div>
            
            <div class="tagline">U.S. Department of Agriculture</div>
            
        </div>
    </a>
</div>
    <button type="button" class="usa-menu-btn">Menu</button>
  </div>

  <nav aria-label="Primary navigation" class="usa-nav border-bottom-2px">
    <div class="usa-nav__inner">
      <button type="button" class="usa-nav__close">
        <img src="/assets/uswds/img/usa-icons/close.svg" alt="close">
      </button>
      
      
      
      <ul class="usa-nav__primary usa-accordion">
        
        <li class="usa-nav__primary-item">
          
          <a class=" usa-nav__link  "
            href="/">
            <span>Home</span>
          </a>
          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-About">
            <span>About</span>
          </button>

          
          

<ul id="nav-About" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/signup"><span>Sign up for an account</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/compute"><span>Computer Systems</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/organization"><span>Organization</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/vrsc"><span>Virtual Research Support Core (VSRC)</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/policies"><span>Policies</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/about/contact"><span>Contact</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-News">
            <span>News</span>
          </button>

          
          

<ul id="nav-News" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/news/downtime/"><span>System Downtime</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/news/announcements"><span>Announcements</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/news/stories"><span>User Stories</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/news/newsletter"><span>Newsletter</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/news/scinet-x"><span>SCINet-X</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-User Guides">
            <span>User Guides</span>
          </button>

          
          

<ul id="nav-User Guides" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/guides/start"><span>Quick Start</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/guides/"><span>All User Guides</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Research">
            <span>Research</span>
          </button>

          
          

<ul id="nav-Research" class="usa-nav__submenu nav-width-2" hidden="">
    <div class="grid-row grid-gap-4">
        
            
            
            
        <li class="usa-nav__submenu-item desktop:grid-col-6 m-top-0">
            

                    
                    
                    <div class="">
                        <a href="/research/working-groups/">
                            Working Groups
                        </a>
                    </div>

                    <ul id="nav-ResearchWorking Groups" class="sublist">


                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/ag100pest">
                                    Ag100Pest
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/arthropods">
                                    Arthropod Genomics
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/fungalbioinformatics">
                                    Fungal Bioinformatics
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/geospatial">
                                    Geospatial Research
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/microbiome">
                                    Microbiome
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/LTARphenology">
                                    LTAR Phenology
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/pollinator">
                                    Pollinator
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/working-groups/proteinfunction">
                                    Protein Function and Phenotype Prediction
                                </a>
                            </li>

                        
                    </ul>
                </li>
            
        
            
            
            
        <li class="usa-nav__submenu-item desktop:grid-col-6 m-top-0">
            

                    
                    
                    <div class="">
                        <a href="/research/uses/">
                            Use Cases
                        </a>
                    </div>

                    <ul id="nav-ResearchUse Cases" class="sublist">


                        

                            <li>
                                <a class="sublinks" href="/research/uses/genomics">
                                    Genomics
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/uses/plant-breeding">
                                    Plant breeding
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/uses/geospatial">
                                    Geospatial
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/research/uses/hydrology">
                                    Hydrology
                                </a>
                            </li>

                        
                    </ul>
                </li>
            
        
    </div>
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Trainings and Events">
            <span>Trainings and Events</span>
          </button>

          
          

<ul id="nav-Trainings and Events" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/training/resources"><span>Learning Resources</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/training/events/"><span>Upcoming Events</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/training/learningpath"><span>Learning Pathway</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Support">
            <span>Support</span>
          </button>

          
          

<ul id="nav-Support" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/support/contact"><span>Contact the VRSC</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/support/faq"><span>FAQs</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="https://forum.scinet.usda.gov"><span>USDA-ARS SCINet Forum</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/support/request"><span>Request Resources</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/support/ceres-job-script"><span>Ceres Job Script Generator</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Opportunities">
            <span>Opportunities</span>
          </button>

          
          

<ul id="nav-Opportunities" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/opportunities/SAC"><span>SAC Membership</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/opportunities/request-workshop"><span>Request a Workshop</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/opportunities/fellowships"><span>Fellowships (PhD & MS)</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/opportunities/ai-innovation/"><span>AI Innovation Fund</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/opportunities/scinet-aicoe-fellowships"><span>SCINet and AI-COE fellowship proposals</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        


      </ul>
      

    </div>

    
    <div class="usa-nav__secondary">
      
      
        <form accept-charset="UTF-8" action="https://search.usa.gov/search" id="search_form" method="get"
class="usa-search usa-search--small js-search-form">
<input name="utf8" type="hidden" value="&#x2713;" />
<input type="hidden" name="affiliate" id="affiliate" value="scinet-usda" />
<div role="search">
  <label for="query" class="usa-sr-only">Enter search terms</label>
  <input autocomplete="off" class="usa-input usagov-search-autocomplete" id="query" name="query"
    type="search" />
  <button class="usa-button" type="submit" name="commit">
    <img src="/assets/uswds/img/usa-icons-bg/search--white.svg"
      class="usa-search__submit-icon" alt="Search" />
  </button>
</div>
</form>

      
    </div>


    </div>
    </div>
  </nav>

</header>



  

    
    


    

    

    

    
    
    




    
    


    <div class="grid-container main-side">


  


  

  







<div class="grid-row grid-gap flex-align-start">
    <div class="usa-layout-docs__sidenav desktop:grid-col-3 desktop:padding-y-10 usa-sticky-sidenav">
        <nav aria-label="Secondary navigation">
  <ul class="usa-sidenav">

    
    





<li class="usa-sidenav__item">
    <a href="/support/contact" 
        >
        Contact the VRSC
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/support/faq" 
        >
        FAQs
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="https://forum.scinet.usda.gov" 
        >
        USDA-ARS SCINet Forum
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/support/request" 
        >
        Request Resources
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/support/ceres-job-script" 
         
        class="usa-current " 
        >
        Ceres Job Script Generator
    </a>
    
    
    
</li>
    

  </ul>
</nav>
    </div>
    
    <div class="usa-layout-docs__main desktop:grid-col-9">
        <nav class="usa-breadcrumb usa-breadcrumb--wrap" aria-label="Breadcrumbs">
  <ol class="usa-breadcrumb__list">
    
    


<li class="usa-breadcrumb__list-item">
  <a href="/" class="usa-breadcrumb__link">
    <span>Home</span>
  </a>
</li>

    

    

    
    
    


    <li class="usa-breadcrumb__list-item usa-current" aria-current="page">
      <span>Ceres Job Script Generator</span>
    </li>
  </ol>
</nav>
        <main class="usa-layout-docs usa-layout-docs__main usa-prose" id="main-content">

          
  
      <h1 class="top-header">Ceres Job Script Generator</h1>
  
  

  

  

  <div id="BYUJobScriptGenerator"></div>
<script>
/*****************************************************************\

Copyright (C) 2014, Brigham Young University

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.

*******************************************************************

Available at: https://github.com/BYUHPC/BYUJobScriptGenerator

Author:  Ryan Cox <ryan_cox@byu.edu>

Modified by: Nathan Weeks <nathan.weeks@ars.usda.gov>

This script generator was originally created for Brigham Young University and
is tailored to its specific needs and configuration.  It is unlikely that this
script will work for you without modification since there are many, many ways
to configure a job scheduler.

This should integrate easily into any existing website.  Use CSS for styling.

TODO:
	job arrays
	tooltip/help for each parameter row

\*****************************************************************/



var BYUScriptGen = function(div) {
	this.values = {};
	this.containerDiv = div;
	this.inputs = {};
	this.inputs.features = {};
	this.formrows = [];
	this.settings = {
		// script_formats = [ ["htmlname1", "Text1"], ["htmlname2", "Text2"], ... ]
		script_formats : [ ["slurm", "Slurm"] ], // first is default
		defaults : {
			email_address : "MY.EMAIL@ars.usda.gov",
		},
		qos : {
			preemptable : "standby",
			test : "test"
		},
		/* You may want to dynamically generate features/partitions. See example HTML file */
		features : {},
		features_status : {},
		partitions : {},
		partitions_status : {},
	};
	return this;
};

BYUScriptGen.prototype.returnNewRow = function (rowid, left, right) {
	var l, r, tr;
	l = document.createElement("td");
	r = document.createElement("td");
	tr = document.createElement("tr");
	l.id = rowid + "_left";
	r.id = rowid + "_right";
	tr.id = rowid;
	l.innerHTML = left;
	r.appendChild(right)
	tr.appendChild(l);
	tr.appendChild(r);
	return tr;
}

BYUScriptGen.prototype.newLabel = function(args){
	var newEl = document.createElement("label");
	var tthis = this;
	if(args.for && args.inner) {
		newEl.onclick = function() {
			return true;
		}
		newEl.htmlFor = args.for;
		newEl.innerHTML= args.inner;
		return newEl;
	}
	return null;
}


BYUScriptGen.prototype.newCheckbox = function(args) {
	var tthis = this;
	var newEl = document.createElement("input");
	newEl.type = "checkbox";
	var formrows = this.formrows;
	if(args.id)
		newEl.id = args.id;
	if(args.checked)
		newEl.checked = true;
	if(args.toggle)
		newEl.onclick = newEl.onchange = function () {
			formrows[args.toggle].style.display = newEl.checked ? "" : "none";
			tthis.updateJobscript();
		};
	else
		newEl.onclick = newEl.onchange = function () {
			 tthis.updateJobscript();
		};
	return newEl;
}

BYUScriptGen.prototype.newInput = function(args) {
	var tthis = this;
	var newEl = document.createElement("input");
	newEl.type = "text";
	if (args.id)
		newEl.id = args.id;
	if(args.size)
		newEl.size = args.size;
	if(args.maxLength)
		newEl.maxLength = args.maxLength;
	if(args.value)
		newEl.value = args.value;
	newEl.onclick = newEl.onchange = function () {
		tthis.updateJobscript();
	};
	return newEl;
}

BYUScriptGen.prototype.newSelect = function(args) {
	var tthis = this;
	var newEl = document.createElement("select");
	if(args.id) 
		newEl.id = args.id;
	if(args.options) {
		for(var i in args.options) {
			var newOpt = document.createElement("option");
			newOpt.value = args.options[i][0];
			newOpt.text = args.options[i][1];
			if(args.selected && args.selected == args.options[i][0])
				newOpt.selected = true;
			newEl.appendChild(newOpt);
		}
	}
	newEl.onclick = newEl.onchange = function () {
		tthis.updateJobscript();
	};
	return newEl;
}

BYUScriptGen.prototype.newGroup = function() {
	var newEl = document.createElement("div");
	newEl.className = "byu-group";
	newEl = this.appendChildren(newEl,arguments)
	return newEl;
};


BYUScriptGen.prototype.newSpan = function() {
	var newEl = document.createElement("span");
     	newEl = this.appendChildren(newEl, arguments);
	return newEl;
};

BYUScriptGen.prototype.appendChildren = function(newEl, args) {
	if(arguments[0])
		newEl.id = args[0];
	for (var i = 1; i < args.length; i++) {
		if(typeof args[i] == "string") {
			newEl.appendChild(document.createTextNode(args[i]));
		} else
			newEl.appendChild(args[i]);
	}
     return newEl
}

BYUScriptGen.prototype.newA = function(url, body) {
	var a = document.createElement("a");
	a.href = url;
	a.appendChild(document.createTextNode(body));
	a.target = "_base";
	return a;
}

BYUScriptGen.prototype.createForm = function(doc) {
    var REQUIRED = '<span style="font-weight:bold;color:red">*</span> ';
	function br() {
		return document.createElement("br");
	}
	function newHeaderRow(text) {
		var headertr = document.createElement("tr");
		var headerth = document.createElement("th");
		headerth.colSpan = 2;
		headerth.appendChild(document.createTextNode(text));
		headertr.appendChild(headerth);
		return headertr;
	}

	var newEl;
	form = document.createElement("form");
	var table = document.createElement("table");
	form.appendChild(table);
	table.appendChild(newHeaderRow("Parameters"));

//	this.inputs.single_node = this.newCheckbox({checked:1});
  	this.inputs.job_script_template = this.newSelect({options:[["standard","standard"], ["rstudio-server", "RStudio Server"]]});
  	this.inputs.node_type = this.newSelect({options:[["standard","standard"], ["large-memory", "large-memory"], ["gpu","gpu"]]});
  	this.inputs.nodes = this.newInput({value:1, size:2, maxLength:2});
	this.inputs.ncores_per_node = this.newInput({value:1, size:3, maxLength:3});
	this.inputs.num_gpus = this.newInput({value:0, size:4});
	this.inputs.mem_per_node = this.newInput({size:7, maxLength:7});
	this.inputs.mem_units = this.newSelect({options:[["GB", "GB"],["MB", "MB"]]});
	var memGr = this.newGroup("mem-group", this.inputs.mem_per_node, this.inputs.mem_units);
	this.inputs.wallhours = this.newInput({value:"00", size:4, maxLength:4, id:"wall-hours"});
	this.inputs.wallmins = this.newInput({value:"00", size:2, maxLength:2, id:"wall-mins"});
	this.inputs.wallsecs = this.newInput({value:"00", size:2, maxLength:2, id:"wall-secs"});
	var wallhoursGr = this.newGroup(null, this.newLabel({for:"wall-hours", inner:"Hours"}), this.inputs.wallhours);
	var wallminsGr = this.newGroup(null, this.newLabel({for:"wall-mins", inner:"Minutes"}), this.inputs.wallmins);
	var wallsecsGr = this.newGroup(null, this.newLabel({for:"wall-secs", inner:"Seconds"}), this.inputs.wallsecs);
	this.inputs.is_test = this.newCheckbox({checked:0});
	this.inputs.is_preemptable = this.newCheckbox({checked:0, toggle:"is_requeueable"});

	this.inputs.is_requeueable = this.newCheckbox({checked:0});
	this.inputs.in_group = this.newCheckbox({checked:0, toggle:"group_name"});
	this.inputs.group_name = this.newInput({value:"MYGROUPNAME"});
	this.inputs.need_licenses = this.newCheckbox({checked:0, toggle:"licenses"});

	this.inputs.lic0_name = this.newInput({});
	this.inputs.lic0_count = this.newInput({size:3, maxLength:4});
	this.inputs.lic1_name = this.newInput({});
	this.inputs.lic1_count = this.newInput({size:3, maxLength:4});
	this.inputs.lic2_name = this.newInput({});
	this.inputs.lic2_count = this.newInput({size:3, maxLength:4});
	this.inputs.job_name = this.newInput({});
	this.inputs.email_begin = this.newCheckbox({checked:0, id:"email-begin"});
	this.inputs.email_end = this.newCheckbox({checked:0, id:"email-end"});
	this.inputs.email_abort = this.newCheckbox({checked:0, id:"email-abort"});
	var email_beginGr = this.newGroup(null, this.inputs.email_begin, this.newLabel({for:"email-begin", inner:"BEGIN"}));
	var email_endGr = this.newGroup(null, this.inputs.email_end, this.newLabel({for:"email-end", inner:"END"}));
	var email_abortGr = this.newGroup(null, this.inputs.email_abort, this.newLabel({for:"email-abort", inner:"ABORT"}));
	this.inputs.email_address = this.newInput({value:this.settings.defaults.email_address,size: this.settings.defaults.email_address.length+10});
	this.inputs.email_address.placeholder = "EMAIL";
	this.inputs.job_output = this.newInput({});
	this.inputs.job_error = this.newInput({});

	table.appendChild(this.returnNewRow("byu_sg_row_job_script_template", REQUIRED + "<b>Job Script Template</b>:<br /><i><u>normal</u> - Run any command-line application <br /><u>RStudio Server</u> - Run RStudio Server on a compute node", this.newSpan(null, this.inputs.job_script_template)));
	table.appendChild(this.returnNewRow("byu_sg_row_node_type", REQUIRED + "<b>Compute node type</b>:<br /><i><u>standard</u> - max 48 cores, 372GB / 381000MB memory<br /><u>large-memory</u> - max 48 cores, 1494 GB / 1530000 MB memory</i>", this.newSpan(null, this.inputs.node_type)));
	table.appendChild(this.returnNewRow("byu_sg_row_nodes", REQUIRED + "<b>Number of compute nodes</b>:<br /><i>Use 1 unless running a distributed-memory parallel application (e.g., Maker)<br />Limits: 57 standard, 5 large-memory</i>", this.inputs.nodes));
	table.appendChild(this.returnNewRow("byu_sg_row_numcores", REQUIRED + "<b>Number of processor cores per node</b>:<br /><i>Limited to 48 per node.<br />Each processor core can simultaneously execute 2 application threads.</i>", this.inputs.ncores_per_node));
//	table.appendChild(this.returnNewRow("byu_sg_row_numgpus", "Number of GPUs: ", this.inputs.num_gpus));
			  table.appendChild(this.returnNewRow("byu_sg_row_walltime", REQUIRED + "<b>Walltime limit</b>:<br /><i>Maximum time the job may run. Shorter jobs may start running sooner.<i>", this.newSpan(null, wallhoursGr, " : " , wallminsGr, " : ", wallsecsGr)));
	table.appendChild(this.returnNewRow("byu_sg_row_mempercore", "<b>Max memory per compute node</b> (1 GB == 1024 MB):<br /><i>Default memory depends on the compute node type:<br /><u>standard</u>: 6400 MB per processor core requested<br /><u>large-memory</u>: 25500 MB per processor core requested</i>", this.newSpan(null, memGr)));
//	table.appendChild(this.returnNewRow("byu_sg_row_testjob", "Job is a <b>test</b> job: ", this.inputs.is_test));
//	table.appendChild(this.returnNewRow("byu_sg_row_preemptable", "Job is preemptable: ", this.inputs.is_preemptable));
	table.appendChild(this.formrows["is_requeueable"] = this.returnNewRow("byu_sg_row_requeueable", "Job is requeueable: ", this.inputs.is_requeueable));
	this.formrows["is_requeueable"].style.display = "none";
// TODO: may need something like this for Project ID
//	table.appendChild(this.returnNewRow("byu_sg_row_fsgroup", "I am in a file sharing group and my group members need <br/>to read/modify my output files: ", this.inputs.in_group));
	table.appendChild(this.formrows["group_name"] = this.returnNewRow("byu_sg_row_fsgroupname", "Group name (case sensitive): ", this.inputs.group_name));
	this.formrows["group_name"].style.display = "none";
//	table.appendChild(this.returnNewRow("byu_sg_row_needlicenses", "Need licenses? ", this.inputs.need_licenses));
	table.appendChild(this.formrows["licenses"] = this.returnNewRow("byu_sg_row_licenses",
					"Licenses: ", this.newSpan(	null,
									"Name ", this.inputs.lic0_name, " Count ", this.inputs.lic0_count, br(),
									"Name ", this.inputs.lic1_name, " Count ", this.inputs.lic1_count, br(),
									"Name ", this.inputs.lic2_name, " Count ", this.inputs.lic2_count
								)
					)
	);
	this.formrows["licenses"].style.display = "none";
	table.appendChild(this.returnNewRow("byu_sg_row_jobname", "<b>Job name</b>:<br /><i>Default is the job script name. Displayed by the <b>squeue</b> command.</i>", this.inputs.job_name));
	table.appendChild(this.returnNewRow("byu_sg_row_emailevents", "<b>Receive email for job events</b>:<br /><i>BEGIN: when job starts, END: when job ends, FAIL: if job fails</i>", 
				this.newSpan(	null,
						email_beginGr,
						email_endGr,
						email_abortGr,
                        			this.inputs.email_address
					    )
			 )
	);
	table.appendChild(this.returnNewRow("byu_sg_row_output", "<b>Job standard output file</b>:<br /><i>Default is \"slurm-%j.out\", where %j is the job ID.</i>", this.inputs.job_output));
	table.appendChild(this.returnNewRow("byu_sg_row_output", "<b>Job standard error file</b>:<br /><i>Default is same file as the job standard output file.</i>", this.inputs.job_error));

	this.inputs.features = [];
	if(this.settings.features.show) {
		var features_span = this.newSpan("byu_sg_input_features");
		for(var i in this.settings.features.names) {
			var new_checkbox = this.newCheckbox({checked:0});
			new_checkbox.feature_name = this.settings.features.names[i];
			this.inputs.features.push(new_checkbox);
			var url = this.newA(this.settings.features.info_base_url + this.settings.features.names[i], "?");
			var feature_container = this.newSpan(null);
			feature_container.className = "byu_sg_input_feature_container";
			var name_span = this.newSpan("byu_sg_input_feature_" + new_checkbox.feature_name, new_checkbox, this.settings.features.names[i] + " [", url, "]");
			name_span.className = "byu_sg_input_feature_name";
			feature_container.appendChild(name_span);
			if(this.settings.features_status && this.settings.features_status[this.settings.features.names[i]]) {
				var feature_status = this.settings.features_status[this.settings.features.names[i]];
				feature_container.appendChild(
					this.newSpan(	null,
							"Nodes avail: ",
							feature_status.nodes_free + "/" + feature_status.nodes_total,
							br(),
							"Cores avail: ",
							feature_status.cores_free + "/" + feature_status.cores_total
					)
				);
			}
			features_span.appendChild(feature_container);
		}
		table.appendChild(this.returnNewRow("byu_sg_input_features", "Features: ", features_span));
	}

	this.inputs.partitions = [];
	if(this.settings.partitions.show) {
		var partitions_span = this.newSpan("byu_sg_input_partitions");
		for(var i in this.settings.partitions.names) {
			var new_checkbox = this.newCheckbox({checked:0});
			new_checkbox.partition_name = this.settings.partitions.names[i];
			this.inputs.partitions.push(new_checkbox);
			var url = this.newA(this.settings.partitions.info_base_url + this.settings.partitions.names[i], "?");
			var partition_container = this.newSpan(null);
			partition_container.className = "byu_sg_input_partition_container";
			var name_span = this.newSpan("byu_sg_input_partition_" + new_checkbox.partition_name, new_checkbox, this.settings.partitions.names[i] + " [", url, "]");
			name_span.className = "byu_sg_input_partition_name";
			partition_container.appendChild(name_span);
			if(this.settings.partitions_status && this.settings.partitions_status[this.settings.partitions.names[i]]) {
				var partition_status = this.settings.partitions_status[this.settings.partitions.names[i]];
				partition_container.appendChild(
					this.newSpan(	null,
							"Nodes avail: ",
							partition_status.nodes_free + "/" + partition_status.nodes_total,
							br(),
							"Cores avail: ",
							partition_status.cores_free + "/" + partition_status.cores_total
					)
				);
			}
			partitions_span.appendChild(partition_container);
		}
		table.appendChild(this.returnNewRow("byu_sg_input_partitions", "Partitions: ", partitions_span));
	}
	
	return form;

}; /* end createForm() */

BYUScriptGen.prototype.retrieveValues = function() {
    
    var MIN_MEMORY = 64; // arbitrary minimum memory amount to avoid, e.g.,
                         // users accidentally requesting MB when they mean GB
// 2018/02/21 current ceres partitions
    var max_memory = {
        mem:     1530000,
        longmem: 1530000,
        short:   381000,
        medium:  381000,
        long:    381000,
        debug:   381000,
		"gpu-low": 379000
    };
    var max_proc_per_node = {
        mem:     48,
        longmem: 40,
        short:   48,
        medium:  48,
        long:    48,
        debug:   36,
		"gpu-low": 36
    };
    var max_nodes = {
        mem:     5,
        longmem: 1,
        short:   57,
        medium:  20,
        long:    10,
        debug:   1,
		"gpu-low": 1
    }
    var max_walltime_in_seconds = {
        mem:     21*24*60*60,          // 21 days
        longmem: 41*24*60*60+16*60*60, // 1000 hours
        short:   2*24*60*60,           // 48 hours
        medium:  7*24*60*60,           // 7 days
        long:    21*24*60*60,          // 21 days
        debug:   60*60,                // 1 hour
		"gpu-low": 2 * 60 * 60

    }
	var partition, jobnotes = [];
	this.values.MB_per_node = Math.round(this.inputs.mem_per_node.value * (this.inputs.mem_units.value =="GB" ? 1024 : 1));

	this.values.features = [];
	for(var i in this.inputs.features) {
		if(this.inputs.features[i].checked){
			this.values.features.push(this.inputs.features[i].feature_name);
		} else {
		}
	}

	this.values.partitions = [];

	this.values.is_test = this.inputs.is_test.checked;
	this.values.is_preemptable = this.inputs.is_preemptable.checked;
	this.values.is_requeueable = this.inputs.is_requeueable && this.inputs.is_requeueable.checked;
	this.values.walltime_in_seconds = Number(this.inputs.wallhours.value) * 3600 + Number(this.inputs.wallmins.value) * 60 + Number(this.inputs.wallsecs.value);
	this.values.ncores_per_node = this.inputs.ncores_per_node.value;
//	if(this.inputs.single_node.checked)
//		this.values.nodes = 1;
    this.values.job_script_template = this.inputs.job_script_template.value;
    this.values.node_type = this.inputs.node_type.value;
    this.values.nodes = this.inputs.nodes.value;
	this.values.gpus = this.inputs.num_gpus.value
	this.values.job_name = this.inputs.job_name.value;
	this.values.sendemail = {};
	this.values.sendemail.begin = this.inputs.email_begin.checked;
	this.values.sendemail.end = this.inputs.email_end.checked;
	this.values.sendemail.abort = this.inputs.email_abort.checked;
	this.values.email_address = this.inputs.email_address.value;
	this.values.job_output = this.inputs.job_output.value;
	this.values.job_error = this.inputs.job_error.value;

    // select partition with the shortest wall time limit that will satisfy the request
    if (this.values.node_type == "large-memory") {
        if (this.values.walltime_in_seconds > max_walltime_in_seconds["longmem"])
		    jobnotes.push("ERROR: wall time exceeds maximum (1000:00:00) for \"longmem\" partition");
        if (this.values.walltime_in_seconds > max_walltime_in_seconds["mem"])
            partition = "longmem";
        else
            partition = "mem";
	} else if (this.values.node_type == "gpu"){
		if (this.values.walltime_in_seconds > max_walltime_in_seconds["gpu-low"])
			jobnotes.push("ERROR: wall time exceeds maximum (" + max_walltime_in_seconds["gpu-low"]/(60*60) + " hours) for \"gpu-low\" partition");
		else
			partition = "gpu-low";
    } else {
        if (this.values.walltime_in_seconds <= max_walltime_in_seconds["short"])
            partition = "short";
        else if (this.values.walltime_in_seconds <= max_walltime_in_seconds["medium"])
            partition = "medium";
        else if (this.values.walltime_in_seconds <= max_walltime_in_seconds["long"])
            partition = "long";
        else
		    jobnotes.push("ERROR: wall time exceeds maximum (504:00:00) for \"long\" partition");
    }

	/* Add warnings, etc. to jobnotes array */
    if (!(this.values.nodes >= 1))
		jobnotes.push("ERROR: number of compute nodes must be >= 1");
    if (!(this.values.MB_per_node == 0 || this.values.MB_per_node >= MIN_MEMORY))
		jobnotes.push("ERROR: if default memory is not specified, the amount of memory requested must be >= " + MIN_MEMORY + " MB");
    if (this.values.nodes > max_nodes[partition])
		jobnotes.push("ERROR: maximum compute nodes in \"" + partition + "\" partition is " + max_nodes[partition]);
	if(this.values.MB_per_node > max_memory[partition])
		jobnotes.push("ERROR: maximum memory on " + this.values.node_type + " node is " + max_memory[partition] + " MB (" + max_memory[partition] / 1024 + " GB)");
    if(this.values.ncores_per_node > max_proc_per_node[partition])
        jobnotes.push("ERROR: requested number of processor cores per node (" + this.values.ncores_per_node + ") exceeds the maximum number of cores on " + this.values.node_type + " compute node(s) (" + max_proc_per_node[partition] + ")"); 
    if (this.values.node_type == "large-memory" && this.values.MB_per_node <= max_memory["short"] && this.values.ncores_per_node <= max_proc_per_node["short"] && this.values.walltime_in_seconds <= 21*24*60*60)
        jobnotes.push("WARNING: this job can run on a standard compute node(s). Consider using compute node type \"standard\"");
    if (this.values.walltime_in_seconds <= 0)
        jobnotes.push("ERROR: walltime limit must be > 00:00:00");

    // rudimentary email validation
    // source: http://stackoverflow.com/questions/46155/validate-email-address-in-javascript
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    if ((this.values.sendemail.begin || this.values.sendemail.end || this.values.sendemail.abort)
        && (this.inputs.email_address.value == this.settings.defaults.email_address
            || ! re.test(this.values.email_address)))
        jobnotes.push("ERROR: please enter a valid email address");

    // basic filename validation
    var re_filename = /^[A-Za-z0-9._%-]+$/; // enforce POSIX portable file name character set + "%"
    if (this.values.job_output.length && !re_filename.test(this.values.job_output))
        jobnotes.push("ERROR: please enter job standard output filename containing only the characters [A-Za-z0-9._%-]");
    if (this.values.job_error.length && !re_filename.test(this.values.job_error))
        jobnotes.push("ERROR: please enter job standard error filename containing only the characters [A-Za-z0-9._%-]");

    this.values.partitions[0] = partition;
	this.jobNotesDiv.innerHTML = jobnotes.join("<br/>\n");
};

BYUScriptGen.prototype.generateScriptPBS = function () {
	this.retrieveValues();

	var scr = "#!/bin/bash\n\n#Submit this script with: qsub thefilename\n\n";
	var walltime = "walltime=" + this.inputs.wallhours.value + ":" + this.inputs.wallmins.value + ":" + this.inputs.wallsecs.value;
	var procs = "procs=" + this.values.ntasks_per_node;

	if(this.inputs.single_node.checked)
		procs = "nodes=1:ppn=" + this.values.ntasks_per_node;

	if(this.inputs.num_gpus.value > 0)
		procs += ":gpus=" + this.inputs.num_gpus.value;
	var features = "";

	if(this.values.features.length > 0)
		features = ",feature='" + this.values.features.join(",") + "'";
	var qos = "";

	if(this.inputs.is_preemptable.checked)
		qos = ",qos=" + this.settings.qos.preemptable;
	else if(this.inputs.is_test.checked)
		qos = ",qos=" + this.settings.qos.test;
	scr += "#PBS -l " + procs + features + ",pmem=" + this.inputs.mem_per_node.value + this.inputs.mem_units.value + "," + walltime + qos + "\n";

	if(this.values.partitions.length > 0)
		scr += "#PBS -q " + this.values.partitions[0] + "\n";
	
	if(this.inputs.job_name.value != "") {
		scr += "#PBS -N " + this.inputs.job_name.value + "\n";
	}
	if(this.inputs.need_licenses.checked) {
		var lics = new Array();
		var show_lics = 0;
		if(this.inputs.lic0_name.value != "" && this.inputs.lic0_count.value > 0) {
			lics.push(this.inputs.lic0_name.value + "+" + this.inputs.lic0_count.value);
			show_lics = 1;
		}
		if(this.inputs.lic1_name.value != "" && this.inputs.lic1_count.value > 0) {
			lics.push(this.inputs.lic1_name.value + "+" + this.inputs.lic1_count.value);
			show_lics = 1;
		}
		if(this.inputs.lic2_name.value != "" && this.inputs.lic2_count.value > 0) {
			lics.push(this.inputs.lic2_name.value + "+" + this.inputs.lic2_count.value);
			show_lics = 1;
		}
		if(show_lics)
			scr += "#PBS -W x=GRES:" + lics.join("%") + "   #format: lic1_name+lic1_count%lic2_name+lic2_count\n";
	}

	if(this.inputs.email_begin.checked || this.inputs.email_end.checked || this.inputs.email_abort.checked) {
		var emailletters = [];
		if(this.inputs.email_begin.checked)
			emailletters.push("b");
		if(this.inputs.email_end.checked)
			emailletters.push("e");
		if(this.inputs.email_abort.checked)
			emailletters.push("a");
		scr += "#PBS -m " + emailletters.join("") + "\n";
		scr += "#PBS -M " + this.inputs.email_address.value + "\n";
		if(this.inputs.email_address.value == this.settings.defaults.email_address)
			scr += "echo \"$USER: Please change the -M option to your real email address before submitting. Then remove this line.\"; exit 1\n";
	}

	var requeueable = this.inputs.is_requeueable.checked ? "#PBS -r y    # Job can be requeued if it is preempted\n" : "";
	scr += requeueable;

	if(this.inputs.in_group.checked) {
		scr += "\n# Set the output permissions on the .oJOBID and .eJOBID files to be 0660 (owner and group can read/write but not others)\n";
		scr += "#PBS -W umask=0007\n";
		scr += "\n# Set the group ownership on the .oJOBID and .eJOBID files to be '" + this.inputs.group_name.value +"'\n";
		scr += "#PBS -W group_list=" + this.inputs.group_name.value + "\n";
		scr += "\n# Set the output permissions on files written from my script to be 0660 and directories to be 0770 (owner and group can read/write but not others)\n";
		scr += "umask 0007\n";
	}
	scr += "\n# LOAD MODULES, INSERT CODE, AND RUN YOUR PROGRAMS HERE\n";

	return scr;
};


BYUScriptGen.prototype.generateScriptSLURM = function () {
	var pbscompat = true;
	var pmemmb;
	var procs;
	var features = "";

    // don't display the job script if there was an error
    if (this.jobNotesDiv.innerHTML.startsWith("ERROR"))
        return '';

	var scr = "#!/bin/bash\n\n";
    if (this.values.job_script_template == "rstudio-server") {
        scr += "# Copy/paste this job script into a text file called rstudio.job and submit with the command:\n"
             + "#    sbatch rstudio.job\n"
             + "# RStudio login information will go to the file $HOME/rstudio-%j.out (where %j is the SLURM job ID)\n";
    }
    else {
        "# Copy/paste this job script into a text file and submit with the command:\n#    sbatch thefilename\n";
        if (!this.values.job_output.length)
            scr += "# job standard output will go to the file slurm-%j.out (where %j is the job ID)\n";
    }
    scr += "\n";
	var sbatch = function sbatch(txt) {
		scr += "#SBATCH " + txt + "\n";
	};
	
	sbatch("--time=" + this.inputs.wallhours.value + ":" + this.inputs.wallmins.value + ":" + this.inputs.wallsecs.value + "   # walltime limit (HH:MM:SS)");
	
	var procs;
	sbatch("--nodes=" + this.values.nodes + "   # number of nodes");
	sbatch("--ntasks-per-node=" + 2 * this.values.ncores_per_node + "   # " + this.values.ncores_per_node + " processor core(s) per node X 2 threads per core");

	if(this.inputs.mem_per_node.value > 0) {
	    sbatch("--mem=" + this.inputs.mem_per_node.value + this.inputs.mem_units.value.substr(0,1) + "   # maximum memory per node");
    }

//	if(this.inputs.single_node.checked) {
//		sbatch("--nodes=1   # number of nodes");
//	}

	if(this.inputs.num_gpus.value > 0) {
		sbatch("--gres=gpu:" + this.inputs.num_gpus.value);
	}

	if(this.values.features.length > 0) {
		var features = this.values.features.join("&");
		sbatch("-C '" + features + "'   # features syntax (use quotes): -C 'a&b&c&d'");
	}
    sbatch("--partition=" + this.values.partitions[0] + "    # " + this.values.node_type + " node(s)");

	if(this.inputs.job_name.value && this.inputs.job_name.value != "") {
		sbatch("--job-name=\"" + this.inputs.job_name.value + "\"");
	}
	
	if(this.inputs.email_begin.checked || this.inputs.email_end.checked || this.inputs.email_abort.checked) {
		sbatch("--mail-user=" + this.values.email_address + "   # email address");
		if(this.inputs.email_begin.checked)
			sbatch("--mail-type=BEGIN");
		if(this.inputs.email_end.checked)
			sbatch("--mail-type=END");
		if(this.inputs.email_abort.checked)
			sbatch("--mail-type=FAIL");
	}

    if (this.values.job_script_template == "rstudio-server")
        sbatch("--output=/home/%u/rstudio-%j.out"); // hard-code home directory for security
    else if(this.values.job_output.length)
        if (this.values.job_error.length)
            sbatch("--output=\"" + this.values.job_output + "\" # job standard output file (%j replaced by job id)");
        else
            sbatch("--output=\"" + this.values.job_output + "\" # job standard output and standard error file (%j replaced by job id)");
    if(this.values.job_error.length)
        sbatch("--error=\"" + this.values.job_error + "\" # job standard error file (%j replaced by job id)");
	if(this.inputs.is_preemptable.checked)
		sbatch("--qos=" + this.settings.qos.preemptable);
	else if(this.inputs.is_test.checked)
		sbatch("--qos=" + this.settings.qos.test);
	if(this.inputs.is_requeueable.checked)
		sbatch("--requeue   #requeue when preempted and on node failure");
	if(this.inputs.need_licenses.checked) {
		var lics = new Array();
		var show_lics = 0;
		if(this.inputs.lic0_name.value != "" && this.inputs.lic0_count.value > 0) {
			lics.push(this.inputs.lic0_name.value + ":" + this.inputs.lic0_count.value);
			show_lics = 1;
		}
		if(this.inputs.lic1_name.value != "" && this.inputs.lic1_count.value > 0) {
			lics.push(this.inputs.lic1_name.value + ":" + this.inputs.lic1_count.value);
			show_lics = 1;
		}
		if(this.inputs.lic2_name.value != "" && this.inputs.lic2_count.value > 0) {
			lics.push(this.inputs.lic2_name.value + ":" + this.inputs.lic2_count.value);
			show_lics = 1;
		}
		if(show_lics)
			sbatch("--licenses=" + lics.join(",") + "   #format: lic1_name:lic1_count,lic2_name:lic2_count");
	}
	if(this.inputs.in_group.checked) {
		sbatch("--gid=" + this.inputs.group_name.value);
	}

    if (this.values.job_script_template == "rstudio-server") {
		sbatch("--signal=USR2");
        scr += `
set -o errexit -o nounset
export PASSWORD=$(openssl rand -base64 15)
# get unused socket per https://unix.stackexchange.com/a/132524
# tiny race condition between the python & singularity commands
readonly PORT=$(python -c 'import socket; s=socket.socket(); s.bind(("", 0)); print(s.getsockname()[1]); s.close()')
cat 1>&2 &lt;&lt;END
VPN Users:

1. Connect to SCINet VPN and point your web browser to http://\${HOSTNAME}:\${PORT}

2. log in to RStudio Server using the following credentials:

   user: \${USER}
   password: \${PASSWORD}

SSH users:

1. SSH tunnel from your workstation using the following command (macOS or Linux only;
   for how to enter this in PuTTY on Windows see the Ceres RStudio User Guide)

   ssh -N -L 8787:\${HOSTNAME}:\${PORT} \${USER}@login.scinet.science

   and point your web browser to http://localhost:8787

2. log in to RStudio Server using the following credentials:

   user: \${USER}
   password: \${PASSWORD}

When done using RStudio Server, terminate the job by:

1. Exit the RStudio Session ("power" button in the top right corner of the RStudio window)
2. On the Ceres command line, issue the command
   
      scancel -f \${SLURM_JOB_ID}
END

if [ ! -e \${HOME}/.Renviron ]
then
  printf '\\nNOTE: creating ~/.Renviron file\\n\\n'
  echo 'R_LIBS_USER=~/R/%p-library/%v' >> \${HOME}/.Renviron
fi

singularity exec --bind $TMPDIR:/tmp \\
    /reference/containers/RStudio/3.5.0/rocker-geospatial.simg \\
    rserver --www-port \${PORT} --auth-none 0 --auth-pam-helper-path=pam-helper

printf 'RStudio Server terminated' 1>&2
`;
    } else
	    scr += "\n# LOAD MODULES, INSERT CODE, AND RUN YOUR PROGRAMS HERE\n";

	return scr;
};

function stackTrace() {
    var err = new Error();
    return err.stack;
}

BYUScriptGen.prototype.updateJobscript = function() {
	this.retrieveValues();
	this.toJobScript();
	return;
};

BYUScriptGen.prototype.init = function() {
	this.inputDiv = document.createElement("div");
	this.inputDiv.id = "byu_sg_input_container";
	this.containerDiv.appendChild(this.inputDiv);

	var scriptHeader = document.createElement("h1");
	scriptHeader.id = "byu_sg_script_header";
	scriptHeader.appendChild(document.createTextNode("Job Script"));
	this.containerDiv.appendChild(scriptHeader);

	this.scriptFormatSelectorDiv = document.createElement("div");
	this.scriptFormatSelectorDiv.id = "byu_sg_script_format_selector_container";
//	this.script_format_selector = this.newSelect({ options : this.settings.script_formats });
//	this.script_format_selector.id = "byu_sg_script_format_selector";
//	this.containerDiv.appendChild(this.newSpan("byu_sg_script_format_selector_container", "Script format:", this.script_format_selector));

	this.form = this.createForm();
	this.inputDiv.appendChild(this.form);

	this.jobNotesDiv = document.createElement("div");
	this.jobNotesDiv.id = "byu_sg_jobnotes";
	this.containerDiv.appendChild(this.jobNotesDiv);

	this.jobScriptDiv = document.createElement("div");
	this.jobScriptDiv.id = "byu_sg_jobscript";
	this.containerDiv.appendChild(this.jobScriptDiv);

	this.updateJobscript();
};

BYUScriptGen.prototype.toJobScript = function() {
	var schedformat = "slurm"; //byu_sg_script_format_selector.options[byu_sg_script_format_selector.selectedIndex].value;
	var scr;
	switch(schedformat) {
		case "slurm" :
			scr = this.generateScriptSLURM();
			break;
		case "pbs" :
			scr = this.generateScriptPBS();
			break;
	}
	this.jobScriptDiv.innerHTML = "<pre>" + scr + "</pre>";
};

var byu_script_gen = new BYUScriptGen(document.getElementById("BYUJobScriptGenerator"));
byu_script_gen.init();
</script>



  

  

  <br>

  


        <br>
    </main>
  </div>
</div>
</div>


    <br>

    

  

  


    
<footer class="usa-footer usa-footer--big">

  
  <div class="grid-container">
    <p>Last updated: May 19, 2023 at 11:18 AM</p>
  </div>
  

  
  <div class="grid-container usa-footer__return-to-top">
    <a href="#">Return to top</a>
  </div>
  

  
  

  <div class="usa-footer__primary-section">
    <div class="grid-container">
          <nav class="usa-footer__nav" aria-label="Footer navigation">
            <div class="grid-row grid-gap-4">
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-3">
                <section class="
                usa-footer__primary-content
                usa-footer__primary-content--collapsible
              ">
              <h4 class="usa-footer__primary-link">ABOUT</h4>
              <ul class="usa-list usa-list--unstyled">
                <li>
                <p>SCINet is a USDA <a href='https://www.ars.usda.gov/'>Agricultural Research Service</a> initiative.</p>
                <a class="usa-button" href="/about/organization">Learn More</a>
                </li>
              </ul>
                </section>
                </div>
              
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-3">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">RESOURCES</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="mailto:scinet_vrsc@usda.gov">
                        Feedback
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/about/signup">
                        Sign Up
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/about/contact">
                        Contact
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/opportunities/fellowships">
                        Fellowships
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-3">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">USDA</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://ask.usda.gov/">
                        AskUSDA
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/">
                        USDA.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.usa.gov">
                        USA.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.whitehouse.gov">
                        WhiteHouse.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/plain-writing">
                        Plain Writing
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-3">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">LEGAL</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/accessibility-statement">
                        Accessibility Statement
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/non-discrimination-statement">
                        Non-Discrimination Statement
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/privacy-policy">
                        Privacy Policy
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.dm.usda.gov/foia/">
                        FOIA
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.ocio.usda.gov/policy-directives-records-forms/information-quality-activities">
                        Information Quality
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
            </div>
          </nav>
    </div>
  </div>

  
  <div class="usa-footer__secondary-section">
    <div class="grid-container sci-heading">
      <div class="grid-row grid-gap">
        <div class="usa-footer__logo grid-row mobile-lg:grid-col-6 tablet:grid-gap-2">
          
          
          <div class="mobile-lg:grid-col-auto footer-flex">
          
<div class="usa-logo">
    
    <span class="agency-logo display-flex flex-align-center mobile-lg:margin-right-1">
        
        <a href="/">
            <img class="usa-logo-img"
                src="/assets/img/site/usda-logo-color.svg"
                alt="USDA">
        </a>
        
    </span>
    
    <a class="agency-logo-text"
        href="/"
        aria-label="SCINet Scientific Computing">
        <div class="agency-identity">
            <div class="agency-name usa-logo__text">SCINet Scientific Computing</div>
            
            <div class="tagline">U.S. Department of Agriculture</div>
            
        </div>
    </a>
</div>
          </div>
          


        </div>

        
        <div class="margin-y-auto mobile-lg:grid-col-4 footer-flex">
          
          <div class="usa-footer__social-links grid-row grid-gap-1">
            <div class="grid-col-auto">
              
              <a class="usa-social-link ext-nested" style="padding-right: .25rem;" href="https://twitter.com/USDA_ARS"
              ><img
                class="usa-social-link__icon"
                src="/assets/uswds/img/usa-icons/twitter.svg"
                alt="Twitter"
            /></a>
              
              <a class="usa-social-link ext-nested" style="padding-right: .25rem;" href="mailto:scinet_vrsc@usda.gov"
              ><img
                class="usa-social-link__icon"
                src="/assets/uswds/img/usa-icons/mail.svg"
                alt="Contact VRSC"
            /></a>
              
            </div>
          </div>
          
        </div>
        
        <div class="grid-row mobile-lg:grid-col-2 footer-flex">
        

<small class="flex-align-self-center"><a href="https://github.com/USDA-SCINet/scinet-site/edit/main/pages/support/ceres-job-script.md" class="usa-sidenav-edit" target="_blank">Edit this page</a></small>
        </div>
        
      </div>
    </div>
  </div>
  

</footer>



  <!-- dynamically determine scripts needed for this config -->







  
    
      <script src="/assets/uswds/js/uswds.min.js" async></script>
    

  
    
      <script src="/assets/js/vendor/anchor.min.js"></script>
    

  
    
      <script src="/assets/js/main.js"></script>
    

  
    
      <script src="/assets/js/external.js"></script>
    

  
    




<script type="text/javascript">
//<![CDATA[
      var usasearch_config = { siteHandle:"scinet-usda" };

      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://search.usa.gov/javascripts/remote.loader.js";
      document.getElementsByTagName("head")[0].appendChild(script);

//]]>
</script>






</body>

</html>